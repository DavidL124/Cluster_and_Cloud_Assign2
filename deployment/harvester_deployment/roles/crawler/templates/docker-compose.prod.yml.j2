## Author: Alex topic
## This docker compose file deploys the cross product of cities and topics containers
## for two cities and two topics, that is four containers, on the single host.

version: '3.8'

{% set cities = ["melbourne", "sydney"] %}
{% set topics = ["environment", "transport"] %}

services:
{% for city in cities %}
  {% for topic in topics %}
    crawler-{{ city }}-{{ topic }}:
      build: ./
      command: python main.py --credentials-id {{ loop.index | string }} --couchdb-host {{ couchdb_server }} --couchdb-username {{ couchdb_user }} --city {{ city }} --topic {{ topic }} --mode stream --debug 
      expose:
        - 5000
      restart: always
    {% endfor %}
{% endfor %}
